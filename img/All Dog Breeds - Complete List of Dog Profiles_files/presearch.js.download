async function f2_initPresearch(e){let r=F2Presearch.timestamp,t=F2Presearch.debug,n=F2Presearch.getRootDomainByUrl,a=(F2Presearch.getRootDomain,F2Presearch.shouldShowAdsFromReferrer),s=F2Presearch.addListener,c=F2Presearch.cloneObj;function i(e){let r=e.innerText||e.textContent||"";return r=r.replace(/[\n\r]+/g," ").trim()}function l(e,r){let n=R.toString();if(r.error=!n||"presearchDebug"!==e&&"presearchShownFail"!==e?null:n,!b.presearchDebugEnable&&"presearchDebug"===e)return;let a="//"+F2Presearch.TRACK_ENDPOINT+"/api/tr?event="+e+"&eventInfo="+encodeURIComponent(JSON.stringify(r))+"&cb="+Date.now();document.createElement("IMG").src=a,t("firePixel(): eventName["+e+"]")}function o(e,r){let t="https://www.facebook.com/tr/?id=649690295426340&ev="+e;"Search"===e&&(t+=" &cd[search_string]="+encodeURIComponent(r.kw));let n={sid:r.sid,said:r.said,kw:r.kw};for(let e in n)n.hasOwnProperty(e)&&(t+="&cd["+encodeURIComponent(e)+"]="+encodeURIComponent(n[e]));document.createElement("IMG").src=t}function d(e){return e.replace(/^http[s]?:\/\//,"").replace(/^www\./g,"").replace(/\?.*/g,"").replace(/#.*/g,"").replace(/\/$/,"").replace(/\//g,"_")}function h(e){return e.replace(/^http[s]?:\/\//,"").replace(/^www\./g,"").replace(/\?.*/g,"").replace(/#.*/g,"").replace(/\/$/,"^")}function u(e){if(!e)return null;let r=e.split(",");for(let e=0;e<r.length;e++){let t=document.querySelector(r[e]);if(t)return t}return null}function p(e,r,t,a,s){return r=r.replace(/{encoded_query}/g,encodeURIComponent(e)).replace(/{unencoded_domain}/g,n(b.presearchPageUrl)).replace(/{encoded_normalized_page_url}/g,encodeURIComponent(h(b.presearchPageUrl))).replace(/{encoded_full_page_url}/g,encodeURIComponent(b.presearchPageUrl)).replace(/{external_click_id}/g,encodeURIComponent(t)).replace(/{user_id}/g,F).replace(/{said}/g,s).replace(/{page_id}/g,N),a.replace(/{encoded_query}/g,encodeURIComponent(e)).replace(/{unencoded_domain}/g,n(b.presearchPageUrl)).replace(/{encoded_normalized_page_url}/g,encodeURIComponent(h(b.presearchPageUrl))).replace(/{encoded_full_advertiser_url}/g,encodeURIComponent(r)).replace(/{encoded_full_page_url}/g,encodeURIComponent(b.presearchPageUrl)).replace(/{external_click_id}/g,encodeURIComponent(t)).replace(/{said}/g,s).replace(/{user_id}/g,F).replace(/{page_id}/g,N)}function f(r,n){if(!r.template||!r.adContents||0===r.adContents.length||!r.injectMarker){let e="Warn: Ad["+r.adId+"], index["+n+"] template is empty or no ad content or no marker";return t(e),R.add(e),l("presearchShownFail",U),!1}t("Start rendering");let a=r.injectMarker,d=r.adId,u=function(e,r){let n=F2Presearch.getTag(r,"AD_CONTAINER"),a=F2Presearch.getTag(r,"AD_ITEM");if(!n||!a)return"";e.maxShow||(e.maxShow=A);let s,c,i="";"edit_mode"===_?c=(s=e.adContents).length:(s=F2Presearch.rotateAdItems(e),c=F2Presearch.getShowNum(s.length,e.maxShow,e.adType),t("total["+s.length+"], maxShow["+e.maxShow+"], showNum["+c+"]"));for(let e=0;e<c;e++){let r=s[e],t=null===r.text?"":r.text,n=null===r.link?"":r.link,c=null===r.thumbnail?"":r.thumbnail,l=null===r.price?"":r.price,o=null===r.brand?"":r.brand,d=null===r.description?"":r.description,h=null===r.rating?"":r.rating,u=null===r.rating_count?"":r.rating_count,p=null===r.display_url?"":r.display_url,f=null===r.call_action?"":r.call_action,g=null===r.id?"":r.id,m=e+1,P=a.replace(/#TEXT#/g,t).replace(/#LINK#/g,n).replace(/#THUMBNAIL#/g,c).replace(/#BRAND#/g,o).replace(/#RATING#/g,h).replace(/#RATING_COUNT#/g,u).replace(/#INDEX#/g,m).replace(/#DESC#/g,d).replace(/#DISPLAY_URL#/g,p).replace(/#CALL_ACTION#/g,f).replace(/#ITEM_ID#/g,g);i+=P=l?P.replace("#PRICE#",l):P.replace("$#PRICE#","&nbsp;")}return n.replace("#HEADER#",e.header).replace("#AD_ITEMS#",i)}(r,r.template);if(!u){let e="Error: Can not extract out ad html and ad item html from template ["+r.adType+"]";return t(e),R.add(e),l("presearchShownFail",U),!1}let f=document.createElement("DIV");if(f.innerHTML=u,f.classList.add(I),f.setAttribute("id",d),r.customCss&&(!function(e,r){let t=document.createElement("style");if(t.setAttribute("type","text/css"),t.styleSheet)t.styleSheet.cssText=e;else{let r=document.createTextNode(e);t.appendChild(r)}(r=r||document.getElementsByTagName("head")[0]).appendChild(t)}(r.customCss,f),t("Custom CSS applied, index="+n)),b.presearchAdWidth&&b.presearchAdHeight){let e="width: "+b.presearchAdWidth+"px; height: "+b.presearchAdHeight+"px;";f.querySelector("div").setAttribute("style",e),t("Got ad dimension '"+b.presearchAdWidth+"x"+b.presearchAdHeight+"' from config, so override it")}"before"===L.injectMode?(a.parentElement.insertBefore(f,a),t("The element is inserted before the marker element")):(a.parentElement.insertBefore(f,a.nextSibling),t("The element is inserted after the marker element"));let g=F2Presearch.getTag(r.template,"AD_SCRIPT");g&&(F2Presearch.addInlineScript(g),t("Add ad script"));let m=f.getElementsByClassName(y);for(let n=0;n<m.length;n++)!function(){let a=m[n],u=n+1,f=L.click_url_template?L.click_url_template:w,g=a.getAttribute("data-item-id"),P=F2Presearch.getAdItemById(r.adContents,g);P&&P.click_url&&(f=P.click_url,t("Detected 'click_url' for item["+g+"], so use it.")),s(a,"click",function(r){if("edit_mode"===_)return void t("In qa edit mode, so do not click.");r.preventDefault?r.preventDefault():r.returnValue=!1;let n=F2Presearch.createUUID(),s=c(U),g=a.getElementsByClassName(S)[0];g?s.kw=i(g):(s.kw="",s.error="Can not get line content element with class["+S+"]");let m=a.href,P=e.presearchSaid?e.presearchSaid:h(b.presearchPageUrl),F=p(s.kw,m,n,f,P);return s.kw_rank=u,s.ad_unit_name=d,s.event_uuid=n,s.dst_url=F,l("presearchClick",s),o("Search",s),window.open(F,"_blank"),t("Clicked url["+F+"], original link["+m+"]"),!1})}();let P=[],F=f.getElementsByClassName(S);for(let e=0;e<F.length;e++)P.push(i(F[e]).trim());let T=c(U);return T.kw=JSON.stringify(P),T.ad_unit_name=r.adId,l("presearchShown",T),!0}function g(e){if(_){let e=document.querySelectorAll("div."+I);for(let r=0;r<e.length;r++)e[r].remove()}for(let r=0;r<e.length;r++)if(!e[r].injectMarker&&(e[r].injectMarker=u(e[r].injectPath),!e[r].injectMarker)){let n="Error: Can not find element with css path: ["+e[r].injectPath+"], index: ["+r+"],adId: ["+e[r].adId+"].";t(n),R.add(n)}f2PresearchConfig.ignoreMerchantCheck||"edit_mode"===_?t("Ignore merchant status checking. f2PresearchConfig.ignoreMerchantCheck["+f2PresearchConfig.ignoreMerchantCheck+"]"):e=F2Presearch.filterOutPausedItems(e,C,b.presearchPageUrl);for(let r=0;r<e.length;r++){f(e[r],r)&&0}window.postMessage({target:"presearch",action:"load_ad_complete"},"*"),t(" <<< Post message 'load_ad_complete'.")}function m(e){return O.replace("{TEMPLATE}",e)}async function P(){let e=k.replace("#ENCODED_PAGE_URL#",encodeURIComponent(b.presearchPageUrl)).replace("#ENCODED_AD_TYPE#",b.presearchAdType?b.presearchAdType:""),r=[q,e];r.push(W[B].url);let s=await F2Presearch.loadResources(r);try{let e=JSON.parse(s[q]);F=e.uid,T=e.country,U.country=e.country}catch(e){let r="Error: fetch User info failed. Error - "+e;t(r),R.add(r)}if("usa"!==T&&!_){let e="Do not show to non-US users, country["+T+"].";return t(e),R.add(e),void l("presearchDebug",U)}if("keyword-theme-autocomplete"===B||"ecommerce-theme-search"===B)return void function(e,r){if(!e)return void t("injectMarker doesn't exist");if(!r)return void t("html template doesn't exist");r=r.replace(/#SID#/g,b.presearchSid).replace(/#SAID#/g,b.presearchSaid).replace(/#PAGE_URL#/g,b.presearchPageUrl).replace(/#EVENT_INFO#/g,JSON.stringify(U)).replace(/#API_ROOT_DOMAIN#/g,F2Presearch.ROOT_DOMAIN).replace(/<[\/]?script>/g,"");let n=F2Presearch.getTag(r,"AD_CONTAINER"),a=document.createElement("DIV");if(a.innerHTML=n,a.classList.add(I),b.presearchAdWidth&&b.presearchAdHeight){let e="width: "+b.presearchAdWidth+"px; height: "+b.presearchAdHeight+"px;";a.querySelector("div").setAttribute("style",e),t("Got ad dimension '"+b.presearchAdWidth+"x"+b.presearchAdHeight+"' from config, so override it")}e.parentElement.insertBefore(a,e);let s=F2Presearch.getTag(r,"AD_SCRIPT");s&&(F2Presearch.addInlineScript(s),t("Add ad script"))}(b.presearchPlacementElement,s[W[B].url]);let c=s[e];c||(c=await F2Presearch.loadResource(J),t("No adData loaded for page level, so fallback to domain level")),c||(c=await F2Presearch.loadResource(H),t("No adData loaded for domain level, so fallback to SID level")),c||t("No adData loaded in SID level");let i=JSON.parse(c).show_only_from_referrer;if(!a(document.referrer,i)){let e="show_only_from_referrer = ["+i+"] and referrer is ["+document.referrer+"], so do not show ads.";return t(e),R.add(e),void l("presearchDebug",U)}for(let e in W)W[e].html=s[W[e].url];if(c){let e=JSON.parse(c);U.ad_unit_version=e.version;let r=e.list;if(b.presearchPlacementElement){let e=r.filter(e=>e.type===b.presearchAdType)[0];e||(t("Can not find ad unit with ad type["+b.presearchAdType+"], so select the first ad unit."),e=r[0]),e.injectMarker=b.presearchPlacementElement,(r=[]).push(e)}C=await async function(e){let r=[];e.forEach(e=>{e.ad_contents.forEach(e=>{let t=n(e.link);-1===r.indexOf(t)&&r.push(t)})});let t=G.replace("{DOMAINS}",encodeURIComponent(r.join(","))),a=await F2Presearch.loadResource(t);return JSON.parse(a)}(r),await async function(e){let r=[];for(let n=0;n<e.length;n++){if(e[n].paused&&"edit_mode"!==_){t("ad unit["+e[n].id+"] is paused");continue}if(!e[n].ad_contents||0==e[n].ad_contents.length){let e="Error: Fetch content [i="+n+"] failed. pageUrl["+b.presearchPageUrl+"], json["+json+"]";t(e),R.add(e);continue}let a={header:e[n].header||"You Might Also Like",adType:e[n].type||v,adTemplate:e[n].template,customCss:j+e[n].custom_css,injectPath:e[n].selector||M,injectMarker:e[n].injectMarker,adContents:e[n].ad_contents,adId:e[n].ad_id,maxShow:e[n].max_show,paused:e[n].paused,enableAbTesting:e[n].enable_ab_testing,abTesting:e[n].ab_testing};a.adTemplate||(t("Ad unit doesn't have template field, so need to guess"),a.adType===v?(a.adTemplate=B,t("Use defaultAdTemplate["+B+"] for the ad unit")):(a.adTemplate=a.adType,t("Use adType["+a.adType+"] as adTemplate for the ad unit")));let s=a.adTemplate;if(!W[s]||!W[s].html){let e=m(s),r=await F2Presearch.loadResource(e);W[s]={url:e,html:r},t("Template["+s+"] was not loaded, so loaded it.")}a.template=W[s].html,r.push(a)}g(r)}(r)}else{let e="No adData, so don't do anything.";t(e),R.add(e),l("presearchDebug",U)}}t("presearch/js/presearch.js is loaded."),F2Presearch.generateClickUrl=p;let _=F2Presearch.QA_MODE,F="",T="",w="https://c.next2.io/api/offers?sid="+e.presearchSid+"&said={said}&link={encoded_full_advertiser_url}&partnerId={external_click_id}&page_url={encoded_full_page_url}",C=null,I="siqps-wrapper",y="siqps-result-item-link",S="siqps-line-content",A=6,D=F2Presearch.PRECLICK_ENDPOINT,x=F2Presearch.DATA_ENDPOINT,E=F2Presearch.API_ENDPOINT,O="//"+x+"/app/search/presearch/template/{TEMPLATE}.html",N="9999",R={errors:[],init:function(){this.errors=[]},add:function(e){this.errors.push(r()+": "+e)},toString:function(){let e="";for(let r=0;r<this.errors.length;r++)e+=this.errors[r]+"\n";return e.trim()}},b=function(){for(let e=1;e<arguments.length;e++)for(let r in arguments[e])arguments[e].hasOwnProperty(r)&&(arguments[0][r]=arguments[e][r]);return arguments[0]}({},{presearchSid:null,presearchSettings:null},e),k="//"+E+"/api/dynamic_offers?page_url=#ENCODED_PAGE_URL#&type=#ENCODED_AD_TYPE#&domain="+F2Presearch.DATA_ENDPOINT;b.presearchPageUrl||(b.presearchPageUrl=location.href,t("No page url passed in, so use 'location.href'."));try{b.presearchSettings?(b.presearchSettings=JSON.parse(b.presearchSettings),t("Parsed 'presearchSettings' in json.")):(b.presearchSettings=(await F2Presearch.getSidConfig(b.presearchSid)).settings,t("Get 'presearchSettings' by sid["+b.presearchSid+"]"))}catch(e){let r="Error: Get 'presearchSettings' failed. Error: "+e;t(r),R.add(r),b.presearchSettings=[]}let U={sid:b.presearchSid,said:b.presearchSaid||n(b.presearchPageUrl),external_referrer:document.referrer,source_url:b.presearchPageUrl,js_version:F2Presearch.js_version,uuid:F2Presearch.createUUID()};t("All variables set"),l("presearchLoad",U);let L=function(e){for(let r=0;r<b.presearchSettings.length;r++){let n=b.presearchSettings[r];if(n&&n.urlPrefix){let r=d(n.urlPrefix);if(0===d(e).indexOf(r))return t("Matched 'presearchSetting' with urlPrefix["+n.urlPrefix+"] for pageUrl["+e+"]."),n}}for(let r=0;r<b.presearchSettings.length;r++){let n=b.presearchSettings[r];if(n&&"*"===n.urlPrefix)return t("Matched 'presearchSetting' with wildcard urlPrefix[*] for pageUrl["+e+"]."),n}return null}(b.presearchPageUrl);if(!L){let e='"presearchSetting" is empty, so do not show presearch, pageUrl['+b.presearchPageUrl+"]";return t(e),R.add(e),void l("presearchDebug",U)}let v=L.adType||"",M=L.injectPath||"",j=L.customCss||"",B=b.presearchAdTemplate||L.adTemplate,q="//"+F2Presearch.UID_ENDPOINT+"/api/connect?include=country",G="//"+D+"/api/reports/merchant_status?sid="+b.presearchSid+"&domains={DOMAINS}&page_url="+encodeURIComponent(b.presearchPageUrl),H="//"+x+"/app/search/presearch/data/default_"+b.presearchSid+".json",J="//"+x+"/app/search/presearch/data/"+F2Presearch.getDomainByUrl(b.presearchPageUrl)+".json",W={qa:{url:m("qa")},ecommerce:{url:m("ecommerce")},keyword:{url:m("keyword")}};B&&!W[B]&&(W[B]={url:m(B)}),P(),window.postMessage({target:"presearch",action:"send_data",data:{js_version:F2Presearch.js_version}},"*"),_&&window.addEventListener("message",function(e){if(e.source==window&&e&&e.data&&"presearch"==e.data.target&&(t(">>> receive message target["+e.data.target+"], action["+e.data.action+"]"),e&&e.data&&"presearch"==e.data.target))if("load_ad"==e.data.action)t(">>> receive action 'load_ad', so loadContent() is triggered from outside."),P();else if("render_ad"==e.data.action&&e.data.renderData){let r=e.data.renderData;if(j)for(let e=0;e<r.length;e++)r[e].customCss=j+r[e].customCss;t(">>> receive action 'render_ad', so render() is triggered from outside."),g(r)}},!1)}window.F2Presearch={},F2Presearch.QA_MODE=window.F2_PRESEARCH_FORCE_LOAD,F2Presearch.js_version="20220608",F2Presearch.ROOT_DOMAIN="searchiq.co",F2Presearch.DATA_ENDPOINT="a.cdn."+F2Presearch.ROOT_DOMAIN,F2Presearch.QA_MODE&&(F2Presearch.DATA_ENDPOINT="s3.us-west-1.amazonaws.com/cdn1.searchiq.co"),F2Presearch.PRECLICK_ENDPOINT="api.next2.io",F2Presearch.API_ENDPOINT="presearch."+F2Presearch.ROOT_DOMAIN,F2Presearch.UID_ENDPOINT="t3."+F2Presearch.ROOT_DOMAIN,F2Presearch.TRACK_ENDPOINT="t2."+F2Presearch.ROOT_DOMAIN,F2Presearch.CONFIG_URL_TPL="//"+F2Presearch.DATA_ENDPOINT+"/app/search/presearch/config/#SID#.json",F2Presearch.isJson=function(e){if(!e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}},F2Presearch.unique=function(e){return e?e.filter(function(e,r,t){return t.indexOf(e)===r}):null},F2Presearch.timestamp=function(){let e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"T"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+"."+e.getMilliseconds()},F2Presearch.debug=function(e){let r=F2Presearch.timestamp;location.href.indexOf("f2debug=1")>-1&&"undefined"!=typeof console&&console.log&&console.log("["+r()+"] presearch.js:"+e)},F2Presearch.createUUID=function(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==r?t:3&t|8).toString(16)})},F2Presearch.urlParam=function(e,r){let t=new RegExp("[\\?&]"+r+"=([^&#]*)").exec(e);return t&&decodeURIComponent(t[1])||""},F2Presearch.getTag=function(e,r){let t=[],n=!1,a=e.split("\n");for(let e=0;e<a.length;e++){let s=a[e];s=="#"+r+"_START#"?n=!0:s=="#"+r+"_END#"?n=!1:n&&t.push(s)}if(0==t.length)return"";if(1==t.length)return t[0];let s="";for(let e=0;e<t.length;e++)s+=t[e]+"\n";return s},F2Presearch.addInlineScript=function(e){let r=document.createElement("SCRIPT");try{r.innerHTML=e}catch(t){r.text=e}document.body.appendChild(r)},F2Presearch.randomWeightedChoice=function(e){let r=Math.random,t=e.length;if(!t)return null;let n=e.reduce(function(e,r){return e+r.weight},0)/t,a={},s=e.reduce(function(e,r){let t=r.id,s=r.weight,c=s+0*(n-s);return c<0&&(c=0),a[t]=(a[t]||0)+c,e+c},0),c=0,i={};if(Object.keys(a).forEach(function(e){c+=a[e],i[e]=c}),s<=0)return null;let l=r()*s,o=Object.keys(i);for(let e=0;e<o.length;e++){let r=o[e];if(l<=i[r])return r}},F2Presearch.rwcSelect=function(e){if(!e||0===e.length)return[];let r=e.slice(0,20),t={};r.forEach(function(e){t[e.text]=e});let n=r.map(function(e){return{id:e.text,weight:e.score}}),a=[];for(;Object.keys(n).length>0;){let e=F2Presearch.randomWeightedChoice(n);a.push(e),n=n.filter(function(r){return r.id!==e})}return a.map(function(e){return t[e]})},F2Presearch.rotateAdItems=function(e){let r=F2Presearch.debug;if(r("Start rotating adunit["+e.adId+"]"),!e.enableAbTesting||!e.abTesting)return r("abTesting is not enabled or ad.ab_Testing is invalid, so do not rotate."),F2Presearch.clearDuplicates(e.adContents);let t=e.abTesting.impression_threshold||2e3,n=e.adContents;n=n.sort(function(e,r){return r.score-e.score}),e.abTesting.ratio=e.abTesting.ratio||"70/30";let a=parseInt(e.abTesting.ratio.split("/")[0]),s=parseInt(e.abTesting.ratio.split("/")[1]),c=[];if(100*Math.random()<a){r("ratioA["+a+"] is selected");let e=F2Presearch.splitLists(n,t,!0);r("Get ["+e.humanChangedList.length+"] human changed items");for(let r=0;r<e.humanChangedList.length;r++){let t=e.humanChangedList[r];c[t.rank-1]=t}let s=0,i=e.performedList.concat(e.notFullfilledList).concat(e.newList).concat(e.punishedList);(i=F2Presearch.shuffleBySeedKeyword(i)).forEach(function(e){for(;c[s];)s++;c[s]=e,s++})}else{r("ratioB["+s+"] is selected");let a=F2Presearch.splitLists(n,t,!1),i=a.newList.concat(a.performedList).concat(a.notFullfilledList).concat(a.punishedList),l=(i=F2Presearch.shuffleBySeedKeyword(i)).slice(0,e.maxShow),o=F2Presearch.shuffle(l),d=i.slice(e.maxShow,i.length);c=o.concat(d)}return F2Presearch.clearDuplicates(c)},F2Presearch.splitLists=function(e,r,t){let n=[],a=[],s=[],c=[],i=[];return e.forEach(function(e){t&&e.human_changed&&e.rank?n.push(e):e.ecpm>0?a.push(e):e.impression?e.impression>0&&e.impression<r?c.push(e):i.push(e):s.push(e)}),{humanChangedList:n,performedList:a,newList:s,notFullfilledList:c,punishedList:i}},F2Presearch.shuffleBySeedKeyword=function(e){function r(e,r){let t=[];for(let n=0;n<e.length;n++){let a=e[n];if(!a.seed_keyword){r.push(a),e[n]=null;continue}let s=a.seed_keyword.trim().toLowerCase();-1===t.indexOf(s)&&(t.push(s),r.push(a),e[n]=null)}return e.filter(function(e){return null!=e})}if(!e||0===e.length)return e;let t=[];for(;e.length>0;)e=r(e,t);return t},F2Presearch.shuffle=function(e){let r,t,n;for(n=e.length-1;n>0;n--)r=Math.floor(Math.random()*(n+1)),t=e[n],e[n]=e[r],e[r]=t;return e},F2Presearch.clearDuplicates=function(e){let r=F2Presearch.debug;if(!e||0===e.length)return[];let t=[],n=[],a=[];for(let s=0;s<e.length;s++){let c=e[s];if(!c)continue;let i=c.text.toLowerCase().trim();t.indexOf(i)>-1?r("Text["+c.text+"] already exist, so not select again."):-1===c.link.indexOf("{encoded_query}")&&n.indexOf(c.link)>-1?r("Link["+c.link+"] already exist, so not select again."):(t.push(i),n.push(c.link),a.push(c))}return a},F2Presearch.getShowNum=function(e,r,t){let n=F2Presearch.debug,a=e<r?e:r;return"keyword"===t&&a>1&&a%2==1&&(n("template is ["+t+"] but show num is not even, so minus 1"),a--),a},F2Presearch.getRootDomainByUrl=function(e){if(!e)return"";let r=document.createElement("A");return r.href=e,F2Presearch.getRootDomain(r.hostname)},F2Presearch.getDomainByUrl=function(e){if(!e)return"";let r=document.createElement("A");return r.href=e,r.hostname},F2Presearch.getRootDomain=function(e){if(!e)return"";let r=e.split(".");return r.length<2?e:r.length>2&&e.match(/(.co.uk|.net.uk|.org.uk|.gov.uk|.com.au|.net.au|.edu.au|.gov.au|.com.cn|.net.cn|.edu.cn|.gov.cn)$/)?r[r.length-3]+"."+r[r.length-2]+"."+r[r.length-1]:r[r.length-2]+"."+r[r.length-1]},F2Presearch.filterOutPausedItems=function(e,r,t){let n=F2Presearch.debug,a=[];for(let s=0;s<e.length;s++){let c=e[s],i=[];for(let e=0;e<c.adContents.length;e++){let n=c.adContents[e],a=F2Presearch.getRootDomainByUrl(n.link);!1===r[a]&&a!==F2Presearch.getRootDomainByUrl(t)||i.push(n)}n("adUnit["+c.adId+"]: filterOutPausedItems(): before["+c.adContents.length+"], after["+i.length+"]"),c.adContents=i,i.length>0&&a.push(c)}return a},F2Presearch.shouldShowAdsFromReferrer=function(e,r){F2Presearch.debug;if(!r)return!0;r=r.replace(/[ ]+/gi,"");let t=F2Presearch.getRootDomainByUrl(e);return(","+r+",").indexOf(","+t+",")>-1},F2Presearch.combineAdData=function(e){F2Presearch.debug;if(!e||0===e.length)return null;if(1===e.length)return e[0];let r=JSON.parse(e[0]),t=[],n=[];return e.forEach(e=>{JSON.parse(e).list.forEach(e=>{-1===t.indexOf(e.ad_id)&&(n.push(e),t.push(e.ad_id))})}),r.list=n,JSON.stringify(r,null,2)},F2Presearch.getPlacementFromScriptHtml=function(e){let r={},t=new RegExp("presearchPlacementId[ ]*:[ ]*[\"']([^\"']+)[\"']").exec(e);return t?(r.adId=t[1],(t=new RegExp("presearchAdType[ ]*:[ ]*[\"']([^\"']+)[\"']").exec(e))&&(r.adType=t[1]),r):null},F2Presearch.httpGet=function(e,r,t,n){n=!!n,"function"!=typeof r&&(r=function(){}),"function"!=typeof t&&(t=function(){});let a=new XMLHttpRequest;a.withCredentials=n,a.open("GET",e,!0),a.send(null),a.onreadystatechange=function(){a.readyState==XMLHttpRequest.DONE&&(a.status>=200&&a.status<400?r(a.responseText):t("Http response status is ["+a.status+"]"))},a.onerror=function(e){}},F2Presearch.loadResource=async function(e){return(await F2Presearch.loadResources([e]))[e]},F2Presearch.loadResources=async function(e,r){let t=F2Presearch.debug;return new Promise((n,a)=>{r=r||30;let s={};for(let r=0;r<e.length;r++)!function(){let n=e[r],a=n.indexOf("/api/connect")>-1;F2Presearch.httpGet(n,function(e){s[n]=e},function(e){s[n]=null,t("Error: Fetch resource["+n+"] failed. Error - "+e)},a)}();let c=setInterval(function(){Object.keys(s).length===e.length&&(clearInterval(c),clearTimeout(i),n(s))},100),i=setTimeout(function(){t("Warn: Timeout to load resource for urls["+e+"]"),clearInterval(c),n(s)},1e3*r)})},F2Presearch.getInlineConfig=async function(e){let r=F2Presearch.debug,t=F2Presearch.urlParam,n=e.src,a=t(n,"sid"),s=t(n,"said"),c=!!t(n,"ifrm"),i=t(n,"url"),l=t(n,"w"),o=t(n,"h"),d=t(n,"type")||"qa",h=t(n,"tpl");return a?(c&&!i&&r("The js tag is in an Iframe and no page url passed in, so use 'document.referrer' as current page url = "+(i=document.referrer)),{presearchSid:a,presearchSaid:s,presearchPlacementElement:e,presearchAdWidth:l,presearchAdHeight:o,presearchAdType:d,presearchAdTemplate:h,presearchPageUrl:i}):(r("Get inline config failed, as 'sid' is missing. script url = "+n),null)},F2Presearch.getSidConfig=async function(e){let r=F2Presearch.debug,t=F2Presearch.CONFIG_URL_TPL.replace("#SID#",e),n=await F2Presearch.loadResource(t),a=JSON.parse(n);return r("Get config by sid from "+t+", value="+n),a},F2Presearch.getAdItemById=function(e,r){if(!e||0===e.length||!r)return null;for(let t=0;t<e.length;t++)if(e[t].id===r)return e[t];return null},F2Presearch.addListener=function(e,r,t){e.addEventListener?e.addEventListener(r,t,!1):e.attachEvent?e.attachEvent("on"+r,t):e["on"+r]=t},F2Presearch.cloneObj=function(e){return e?JSON.parse(JSON.stringify(e)):{}},async function(){if(window.f2PresearchConfig)f2PresearchConfig.sid&&(f2PresearchConfig.presearchSid=f2PresearchConfig.sid),f2PresearchConfig.said&&(f2PresearchConfig.presearchSaid=f2PresearchConfig.said),f2PresearchConfig.width&&(f2PresearchConfig.presearchAdWidth=f2PresearchConfig.width),f2PresearchConfig.height&&(f2PresearchConfig.presearchAdHeight=f2PresearchConfig.height),f2PresearchConfig.type&&(f2PresearchConfig.presearchAdType=f2PresearchConfig.type),f2PresearchConfig.template&&(f2PresearchConfig.presearchAdTemplate=f2PresearchConfig.template),f2_initPresearch(window.f2PresearchConfig);else{let e=document.currentScript;F2Presearch.debug("Presearch could be loaded by url, so checking");let r=await F2Presearch.getInlineConfig(e);r&&(F2Presearch.debug("Load presearch with config: "+JSON.stringify(r,null,2)),f2_initPresearch(r))}}();